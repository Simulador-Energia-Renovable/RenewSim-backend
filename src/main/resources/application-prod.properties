# =============================
# DATASOURCE (PostgreSQL - Render)
# =============================
spring.datasource.url=jdbc:postgresql://${SPRING_DATASOURCE_HOST}:${SPRING_DATASOURCE_PORT}/${SPRING_DATASOURCE_DB}?sslmode=require
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# =============================
# JPA / Hibernate (producción)
# =============================
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.open-in-view=false

# =============================
# HikariCP (Connection Pool)
# =============================
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.idle-timeout=30000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-timeout=30000
# Reduce stale connections en PaaS:
spring.datasource.hikari.keepalive-time=150000

# =============================
# SERVER / Proxy (Render)
# =============================
server.forward-headers-strategy=framework
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain,text/css,application/javascript

# =============================
# LOGGING
# =============================
logging.level.org.springframework.security=WARN
logging.level.AUTH_AUDIT=WARN
# (Opcional si usas pattern no-JSON y quieres ver correlationId)
# logging.pattern.level=%5p [corr=%X{correlationId}]

# =============================
# ACTUATOR (exposición mínima)
# =============================
management.endpoints.web.exposure.include=health,info
management.endpoint.health.probes.enabled=true

# =============================
# CORS (dominios permitidos en prod)
# =============================
cors.enabled=true
cors.allowed-origins=https://renewsim.example.com
cors.allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
cors.allowed-headers=Content-Type,Authorization,X-Requested-With,X-Correlation-Id
cors.exposed-headers=X-Correlation-Id
cors.allow-credentials=true
cors.max-age-seconds=3600

# =============================
# JWT (HS256)
# =============================
security.jwt.issuer=renewsim-auth
security.jwt.audience=renewsim-app
security.jwt.secretBase64=${JWT_SECRET_BASE64}   # definir en Render Dashboard (>=32 bytes reales antes de Base64)
security.jwt.expiration-seconds=3600
security.jwt.not-before-skew-seconds=0
security.jwt.allowed-clock-skew-seconds=60

# =============================
# RATE LIMITING (Brute-force guard)
# =============================
security.rate-limiting.enabled=true
security.rate-limiting.strategy=IP_USER
security.rate-limiting.max-attempts=10
security.rate-limiting.window-seconds=60
security.rate-limiting.retry-after-seconds=60
security.rate-limiting.login-path=/api/v1/auth/login






